<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Эльзас и Лотарингия: Полный Путеводитель</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Google Fonts: Playfair Display & Noto Sans (Italic versions) -->
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@1,400;1,700&family=Noto+Sans:ital,wght@1,400;1,600&display=swap" rel="stylesheet">

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        art: {
                            sage: '#7B8E7E',
                            gold: '#C5A059',
                            wine: '#8B4343',
                            cream: '#F9F4E8',
                            dark: '#2D3436'
                        }
                    },
                    fontFamily: {
                        serif: ['Playfair Display', 'serif'],
                        sans: ['Noto Sans', 'sans-serif'],
                    }
                }
            }
        }
    </script>
    <style>
        * {
            font-style: italic !important;
        }
        
        body {
            background-color: #F9F4E8;
            color: #2D3436;
            background-image: radial-gradient(#C5A059 0.4px, transparent 0.4px);
            background-size: 30px 30px;
        }

        .nouveau-border {
            position: relative;
            border: 2px solid #C5A059;
            border-radius: 40px 5px 40px 5px;
        }

        .nouveau-header {
            font-family: 'Playfair Display', serif;
        }

        .nav-item {
            transition: all 0.3s ease;
            border-radius: 0 50px 50px 0;
            margin-right: 10px;
            position: relative;
            overflow: hidden;
        }

        .active-day {
            background: linear-gradient(90deg, #8B4343 0%, #C5A059 100%);
            color: white !important;
            padding-left: 1.5rem;
            box-shadow: 4px 4px 10px rgba(139, 67, 67, 0.15);
        }

        .loading-dot {
            width: 6px;
            height: 6px;
            background-color: #C5A059;
            border-radius: 50%;
            display: inline-block;
            margin-left: 8px;
            animation: pulse 1.5s infinite;
        }

        @keyframes pulse {
            0% { opacity: 0.3; transform: scale(0.8); }
            50% { opacity: 1; transform: scale(1.2); }
            100% { opacity: 0.3; transform: scale(0.8); }
        }

        .day-scroller::-webkit-scrollbar { width: 3px; }
        .day-scroller::-webkit-scrollbar-thumb { background: #C5A059; border-radius: 10px; }

        .detail-card {
            background: white;
            border-left: 1px solid #C5A059;
            padding-left: 1.5rem;
            margin-bottom: 2rem;
        }

        .art-nouveau-frame {
            position: relative;
            padding: 15px;
            background: #fff;
            border: 1px solid #C5A059;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            margin-bottom: 2rem;
        }
        
        .art-nouveau-frame::before {
            content: "❦";
            position: absolute;
            top: -10px;
            left: 50%;
            transform: translateX(-50%);
            background: #F9F4E8;
            padding: 0 10px;
            color: #C5A059;
            font-size: 1.5rem;
        }

        .img-container {
            width: 100%;
            aspect-ratio: 16 / 9;
            background: #eee;
            overflow: hidden;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
        }

        .img-placeholder-pattern {
            background-image: url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M30 30c0-10 10-20 20-20s10 10 0 20-20 10-20 10-10-10-20-10-10-10 0-20 20 10 20 20z' fill='%23C5A059' fill-opacity='0.1' fill-rule='evenodd'/%3E%3C/svg%3E");
        }

        .loading-overlay {
            position: absolute;
            inset: 0;
            background: rgba(249, 244, 232, 0.8);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 20;
        }

        .spinner {
            width: 40px;
            height: 40px;
            border: 3px solid #C5A05933;
            border-top: 3px solid #8B4343;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    </style>
</head>
<body class="flex flex-col min-h-screen font-sans">

    <header class="bg-art-dark text-art-cream py-12 border-b-4 border-art-gold shadow-lg">
        <div class="container mx-auto px-4 text-center">
            <h1 class="nouveau-header text-5xl md:text-6xl mb-3">Эльзас и Лотарингия</h1>
            <div class="flex items-center justify-center gap-4 text-art-gold mb-4">
                <span class="text-3xl">❦</span>
                <p class="uppercase tracking-[0.4em] text-sm font-light">Культурная Экспедиция 2026</p>
                <span class="text-3xl">❦</span>
            </div>
            <div class="inline-block border border-art-gold/40 px-8 py-2 rounded-full text-sm italic">
                Базирование: Эпфиг • Сердце винной дороги
            </div>
        </div>
    </header>

    <main class="flex-grow container mx-auto px-4 py-12 grid grid-cols-1 lg:grid-cols-12 gap-10">
        <aside class="lg:col-span-3">
            <div class="bg-white/90 backdrop-blur-md p-6 nouveau-border sticky top-8 flex flex-col max-h-[85vh]">
                <h2 class="nouveau-header text-2xl text-art-wine mb-6 text-center border-b border-art-gold/20 pb-4">Маршрут</h2>
                <div class="day-scroller overflow-y-auto space-y-2 pr-2" id="day-list"></div>
                <div id="global-status" class="mt-4 text-[10px] text-art-gold uppercase text-center opacity-60 italic">
                    Загрузка визуализаций...
                </div>
            </div>
        </aside>

        <section class="lg:col-span-9">
            <div id="day-detail-view" class="bg-white/80 p-8 md:p-12 nouveau-border shadow-xl min-h-screen transition-all duration-700"></div>
        </section>
    </main>

    <footer class="bg-art-dark text-art-cream py-20 border-t-8 border-art-gold mt-16 text-center">
        <div class="container mx-auto px-4 italic opacity-80 leading-loose">
            «В Арт-Нуво природа не просто копируется, она переосмысляется через линию...»
        </div>
    </footer>

    <script>
        const apiKey = ""; 
        const generatedImages = {}; 
        const imageLoadingStates = {}; 
        let currentDayId = 1;

        const itineraryData = [
            { 
                id: 1, 
                date: "20 марта", 
                title: "Начало Эльзаса: Эпфиг", 
                summary: "Городок, где камни помнят римлян и традиции виноделия передаются веками.", 
                imagePrompt: "Art Nouveau illustration of a cozy Alsatian village Epfig with vineyards, rolling hills, morning mist, in the style of Alphonse Mucha, pastel colors.", 
                points: [
                    { 
                        name: "Эпфиг (Epfig)", 
                        details: "Уютная коммуна, расположенная на знаменитой Винной дороге. Здесь можно увидеть аутентичные фахверковые дома XVII-XVIII веков. Эпфиг славится своими виноградниками Grand Cru Fronholz. Это место идеально для неспешных прогулок, где каждый поворот открывает вид на черепичные крыши и виноградные террасы." 
                    }, 
                    { 
                        name: "Часовня Сен-Маргарит (Chapelle Sainte-Marguerite)", 
                        details: "Жемчужина романского стиля XI века. Часовня стоит на месте древнеримского поселения. Её архитектура поражает лаконичностью и гармонией. Внутри сохранились древние фрески, а снаружи — уникальный портик с резными капителями. Окружающий ландшафт создает атмосферу глубокого спокойствия и связи с прошлым." 
                    }
                ],
                gastronomy: [
                    { type: "Ресторан", name: "A la Couronne", desc: "Семейный ресторан с 1685 года. Попробуйте здесь 'Шукрут' — тушеную капусту с местными колбасками в лучшем исполнении." },
                    { type: "Кофейня", name: "Pâtisserie Kamm", desc: "Славится своими традиционными эльзасскими пирогами и ароматным кофе." },
                    { type: "Шопинг", name: "Domaine Ostertag", desc: "Винодельня мирового уровня. Купите здесь бутылку Рислинга с уникальными авторскими этикетками." }
                ],
                tips: "Обязательно посетите частную дегустацию у местного винодела — здесь делают лучший Клеман (игристое)." 
            },
            { 
                id: 2, 
                date: "21 марта", 
                title: "Страсбург: Имперский масштаб", 
                summary: "Перекресток Европы, объединяющий величие готики и изящество французского ренессанса.", 
                imagePrompt: "Strasbourg Cathedral and Petite France canals in Art Nouveau style, intricate stained glass, flowing water, wood-framed houses.", 
                points: [
                    { 
                        name: "Страсбургский собор (Notre-Dame)", 
                        details: "Один из самых высоких соборов мира, построенный из розового вогезского песчаника. Его фасад напоминает каменное кружево. Внутри находятся Астрономические часы — чудо механики XVI века, которые оживают каждый полдень." 
                    }, 
                    { 
                        name: "Квартал 'Маленькая Франция' (La Petite France)", 
                        details: "Самый живописный район Страсбурга, объект наследия ЮНЕСКО. Это сеть каналов, вдоль которых стоят старинные дома кожевников и рыбаков." 
                    }
                ],
                gastronomy: [
                    { type: "Ресторан", name: "Maison Kammerzell", desc: "Самый красивый дом города у собора. Фирменное блюдо — рыбный шукрут." },
                    { type: "Кофейня", name: "Christian", desc: "Легендарная кондитерская с интерьерами в стиле барокко. Лучший горячий шоколад." },
                    { type: "Шопинг", name: "Beauvillé", desc: "Бутик знаменитого эльзасского текстиля с принтами, вдохновленными природой и фольклором." }
                ],
                tips: "Возьмите речной трамвайчик Batorama — это лучший способ увидеть город с необычного ракурса." 
            },
            { 
                id: 3, 
                date: "22 марта", 
                title: "Вертикаль истории: Замки", 
                summary: "Могущественные крепости на вершинах гор, хранящие тайны Средневековья.", 
                imagePrompt: "Medieval Haut-Koenigsbourg castle on a mountain top, fog, dark green forests, Art Nouveau border with organic ivy.", 
                points: [
                    { 
                        name: "Замок Верхний Кенигсбург (Haut-Koenigsbourg)", 
                        details: "Величественная крепость XII века, возвышающаяся на скале. Замок был полностью отреставрирован в начале XX века, сохранив дух рыцарства." 
                    }, 
                    { 
                        name: "Город Оберне (Obernai)", 
                        details: "Второй по посещаемости город департамента Нижний Рейн. Оберне сохранил кольцо крепостных стен и уют старинных площадей." 
                    }
                ],
                gastronomy: [
                    { type: "Ресторан", name: "La Cloche", desc: "Атмосфера старой таверны и огромные порции традиционного Тарт Фламбе." },
                    { type: "Кофейня", name: "L'Oie Gourmande", desc: "Уютное место для послеобеденного чая с домашним Кугельхопфом." },
                    { type: "Шопинг", name: "Le Comptoir de Mathilde", desc: "Магазин ремесленных сладостей, паштетов и знаменитых 'соленых' баба́." }
                ],
                tips: "В Оберне попробуйте местный 'пирог святой Одилии' в одной из кондитерских на площади." 
            },
            { 
                id: 4, 
                date: "23 марта", 
                title: "Нанси: Столица Арт-Нуво", 
                summary: "Город, ставший колыбелью французского модерна и изящных искусств.", 
                imagePrompt: "Place Stanislas Nancy with golden wrought iron gates, Art Nouveau floral ornaments, Nancy School style, dragonfly motifs.", 
                points: [
                    { 
                        name: "Площадь Станислава (Place Stanislas)", 
                        details: "Считается одной из самых красивых площадей в мире. Ансамбль XVIII века с его золочеными коваными воротами и фонтанами." 
                    }, 
                    { 
                        name: "Музей Школы Нанси (Musée de l'École de Nancy)", 
                        details: "Уникальный музей, посвященный движению Арт-Нуво в бывшем особняке мецената Корбена." 
                    }
                ],
                gastronomy: [
                    { type: "Ресторан", name: "Excelsior", desc: "Шедевр Арт-Нуво! Интерьер 1911 года. Попробуйте местную закуску 'Паштет Нанси'." },
                    { type: "Кофейня", name: "Maison Macarons", desc: "Единственное место, где делают оригинальные макароны Нанси по рецепту 1793 года." },
                    { type: "Шопинг", name: "Daum", desc: "Флагманский магазин легендарной стекольной мануфактуры. Изделия из хрусталя в стиле модерн." }
                ],
                tips: "Прогуляйтесь до виллы Мажорель (Villa Majorelle) — это первый полностью модернистский дом в Нанси." 
            },
            { 
                id: 5, 
                date: "24 марта", 
                title: "Кольмар: Город-открытка", 
                summary: "Сказочное переплетение фахверка, цветов и воды в сердце эльзасских традиций.", 
                imagePrompt: "Colmar Little Venice and Eguisheim spiral streets, colorful timber-framed houses, spring flowers, Art Nouveau poster style.", 
                points: [
                    { 
                        name: "Район 'Маленькая Венеция' (La Petite Venise)", 
                        details: "Старинный квартал вдоль реки Лош. Дома здесь выкрашены в яркие цвета, создавая неповторимый ансамбль." 
                    }, 
                    { 
                        name: "Деревня Эгисхайм (Eguisheim)", 
                        details: "Уникальная деревня, построенная концентрическими кругами вокруг замка. Узкие улочки украшены геранью." 
                    }
                ],
                gastronomy: [
                    { type: "Ресторан", name: "JY'S", desc: "Две звезды Мишлен на берегу канала в историческом здании XVII века." },
                    { type: "Кофейня", name: "Au Croissant Doré", desc: "Антикварная кофейня с атмосферой начала века. Идеально для завтрака." },
                    { type: "Шопинг", name: "Potterie d'Eguisheim", desc: "Традиционная эльзасская керамика ручной работы — горшки для бекеоффе и формы для кексов." }
                ],
                tips: "В Кольмаре посетите музей Унтерлинден, чтобы увидеть знаменитый Изенгеймский алтарь." 
            },
            { 
                id: 6, 
                date: "25 марта", 
                title: "Мец: Свет и Солнечный Камень", 
                summary: "Город с 3000-летней историей, где сияет золотистый камень 'пьер де жомон'.", 
                imagePrompt: "Metz Cathedral with Marc Chagall stained glass windows, glowing yellow stone, Art Nouveau stained glass patterns, mystic light.", 
                points: [
                    { 
                        name: "Собор Сент-Этьен (Cathédrale Saint-Étienne)", 
                        details: "Называемый 'Фонарем Бога' из-за самой большой площади остекления в Европе. Витражи Марка Шагала." 
                    }, 
                    { 
                        name: "Центр Помпиду-Мец (Centre Pompidou-Metz)", 
                        details: "Шедевр современной архитектуры от Шигеру Бана с уникальной деревянной крышей." 
                    }
                ],
                gastronomy: [
                    { type: "Ресторан", name: "Brasserie Flo", desc: "Классика французского бистро в изысканном интерьере бывшего театра." },
                    { type: "Кофейня", name: "Fox Coffee Shop", desc: "Современная кофейня в историческом центре с отличным спешелти-кофе." },
                    { type: "Шопинг", name: "Marché Couvert de Metz", desc: "Рынок в здании бывшего епископского дворца. Купите ликеры и джемы из лотарингской мирабели." }
                ],
                tips: "Обязательно пройдите через квартал Империаль (Quartier Impérial) — это учебник архитектуры под открытым небом." 
            }
        ];

        async function fetchWithRetry(url, options, maxRetries = 5) {
            let delay = 1000;
            for (let i = 0; i < maxRetries; i++) {
                try {
                    const response = await fetch(url, options);
                    if (response.ok) return response;
                    await new Promise(res => setTimeout(res, delay));
                    delay *= 2;
                } catch (e) {}
            }
            return fetch(url, options);
        }

        async function startBackgroundGeneration() {
            const promises = itineraryData.map(day => generateImage(day.id));
            await Promise.allSettled(promises);
            const status = document.getElementById('global-status');
            if (status) status.innerText = "Все визуализации готовы";
        }

        async function generateImage(dayId) {
            if (imageLoadingStates[dayId] === 'done' || imageLoadingStates[dayId] === 'loading') return;
            
            const day = itineraryData.find(d => d.id === dayId);
            imageLoadingStates[dayId] = 'loading';
            renderDayList();
            
            const container = document.getElementById(`img-wrap-${dayId}`);
            if (container && !generatedImages[dayId]) {
                container.innerHTML = '<div class="loading-overlay"><div class="spinner"></div><p class="mt-4 text-art-wine text-[10px] uppercase tracking-widest">Фоновая генерация...</p></div>';
            }

            try {
                const url = `https://generativelanguage.googleapis.com/v1beta/models/imagen-4.0-generate-001:predict?key=${apiKey}`;
                const response = await fetchWithRetry(url, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        instances: [ { prompt: day.imagePrompt } ],
                        parameters: { sampleCount: 1 }
                    })
                });

                if (response.ok) {
                    const result = await response.json();
                    if (result.predictions?.[0]?.bytesBase64Encoded) {
                        const imgUrl = `data:image/png;base64,${result.predictions[0].bytesBase64Encoded}`;
                        generatedImages[dayId] = imgUrl;
                        imageLoadingStates[dayId] = 'done';
                        if (currentDayId === dayId) updateImageView(dayId, imgUrl);
                    }
                }
            } catch (error) {
                imageLoadingStates[dayId] = 'error';
            } finally {
                renderDayList();
            }
        }

        function updateImageView(dayId, url) {
            const container = document.getElementById(`img-wrap-${dayId}`);
            if (container) {
                container.innerHTML = `<img src="${url}" class="w-full h-full object-cover animate-fadeIn" alt="Day ${dayId}">`;
            }
        }

        function selectDay(id) {
            currentDayId = id;
            renderDayList();
            renderDayDetail(id);
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        function renderDayList() {
            const list = document.getElementById('day-list');
            if (!list) return;
            list.innerHTML = '';
            itineraryData.forEach(day => {
                const isActive = day.id === currentDayId;
                const state = imageLoadingStates[day.id];
                let indicator = state === 'loading' ? '<span class="loading-dot"></span>' : (state === 'done' ? '<span class="ml-2 text-art-gold">✓</span>' : '');

                const div = document.createElement('div');
                div.className = `nav-item p-4 cursor-pointer text-sm transition-all ${isActive ? 'active-day' : 'hover:bg-art-gold/10'}`;
                div.onclick = () => selectDay(day.id);
                div.innerHTML = `<span class="block text-[10px] uppercase opacity-60">${day.date} ${indicator}</span><span class="nouveau-header font-bold block">${day.title}</span>`;
                list.appendChild(div);
            });
        }

        function renderDayDetail(id) {
            const day = itineraryData.find(d => d.id === id);
            const view = document.getElementById('day-detail-view');
            if (!day || !view) return;
            
            const pointsHtml = day.points.map(p => `
                <div class="detail-card">
                    <h3 class="nouveau-header text-2xl text-art-wine italic mb-2">❦ ${p.name}</h3>
                    <p class="text-art-dark leading-relaxed italic text-justify">${p.details}</p>
                </div>
            `).join('');

            const gastroHtml = day.gastronomy.map(g => `
                <div class="mb-4 last:mb-0">
                    <span class="text-[10px] font-bold text-art-gold uppercase tracking-wider block mb-1">${g.type}</span>
                    <h5 class="font-bold text-art-wine">${g.name}</h5>
                    <p class="text-sm text-gray-600 leading-snug italic">${g.desc}</p>
                </div>
            `).join('');

            const imgContent = generatedImages[id] 
                ? `<img src="${generatedImages[id]}" class="w-full h-full object-cover animate-fadeIn" alt="Day ${id}">` 
                : `<div class="loading-overlay"><div class="spinner"></div><p class="mt-4 text-art-wine text-[10px] uppercase tracking-widest">Загрузка шедевра...</p></div>`;

            view.innerHTML = `
                <div class="animate-fadeIn">
                    <div class="mb-10 border-b-2 border-art-gold/20 pb-6">
                        <span class="text-art-gold text-sm uppercase tracking-[0.3em] font-bold">День ${day.id} • ${day.date}</span>
                        <h2 class="nouveau-header text-5xl text-art-dark mt-2 mb-4 italic">${day.title}</h2>
                        <p class="text-lg text-gray-500 italic">« ${day.summary} »</p>
                    </div>
                    
                    <div class="art-nouveau-frame">
                        <div id="img-wrap-${id}" class="img-container img-placeholder-pattern">${imgContent}</div>
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-3 gap-10">
                        <div class="md:col-span-2">
                            <h4 class="nouveau-header text-3xl text-art-dark mb-6 border-b border-art-gold/20 pb-2 italic">Локации</h4>
                            <div class="space-y-6">${pointsHtml}</div>
                        </div>
                        <div>
                            <h4 class="nouveau-header text-3xl text-art-dark mb-6 border-b border-art-gold/20 pb-2 italic">Рекомендации</h4>
                            <div class="bg-art-gold/5 p-6 border-l-2 border-art-gold">${gastroHtml}</div>
                        </div>
                    </div>

                    <div class="mt-12 bg-art-sage/5 p-6 rounded-3xl border border-art-gold/20 italic">
                        <h4 class="nouveau-header text-art-wine text-lg mb-2">Совет:</h4>
                        <p class="text-art-dark">❧ ${day.tips}</p>
                    </div>
                </div>
            `;
        }

        window.onload = () => {
            renderDayList();
            renderDayDetail(currentDayId);
            startBackgroundGeneration();
        };
    </script>

    <style>
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        .animate-fadeIn { animation: fadeIn 1s ease-out; }
    </style>
</body>
</html>